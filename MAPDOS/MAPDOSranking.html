<!DOCTYPE html>
<html>
<head>
  <title>MAPDOS Response Ranker</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: repeating-linear-gradient(
        315deg,
        #9F5148,
        #9F5148 20px,
        #584238 20px,
        #584238 40px
      );
      color: white;
      text-align: center;
    }

    #prompt {
      font-weight: bold;
      font-size: 1.4em;
      margin-bottom: 1em;
    }

    #canvas {
  padding: 1em;
  min-height: 300px;
  display: flex;
  flex-direction: column;
  gap: 0.5em;
  align-items: center;
  background: none;
  border: none;
}


    .response {
  position: relative;
  width: 100%;
  font-size: 1.1em;
  padding: 0.75em 1em;
  color: white;
  cursor: move;
  border-radius: 1rem;
  background-color: #584238;
  overflow: hidden;
  box-sizing: border-box;
}

/* Flat yellow top band behind text */
.response::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 50%;
  background-color: #ffa172;
  /* Remove z-index or set it to a negative value */
  z-index: -1;
}

/* Ensure text and content sit above the yellow band */
.response > * {
  position: relative;
  z-index: 1;
}
    input[type="text"] {
      width: 50%;
      background-color: #584238;
      color: white;
      border: none;
      outline: 4px solid #9F5148;
      border-radius: 1rem;
      padding: 0.5em 1em;
      font-size: 1em;
      box-sizing: border-box;
      text-align: center;
      margin-top: 1em;
    }

    input[type="text"]::placeholder {
      color: #BFFFFF;
      opacity: 1;
    }

    button {
      border-radius: 1rem;
      background-color: #FE467C;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 1em;
    }

    button:hover {
      background-color: #FFFF80;
      color: white;
    }

    button:active {
      background-color: #00FF80;
      color: white;
    }#promptContainer {
  width: 100%;
  background-color: #9F5148;
  border: 4px solid #584238;
  border-top-left-radius: 2rem;
  border-top-right-radius: 2rem;
  border-bottom-left-radius: 0.5rem;
  border-bottom-right-radius: 0.5rem;
  padding: 1em;
  margin-bottom: 1em;
  box-sizing: border-box;
  color: white;
  font-size: 1.4em;
  font-weight: bold;
  text-align: center;
}

  </style>
</head>
<body>

<div id="promptContainer">
  <div id="prompt">Loading prompt...</div>
</div>

<div id="canvas"></div>

<input type="text" id="voterName" placeholder="Enter your name" />
<br>
<button onclick="submitVote()">Submit Vote</button>

<script>
  const macroURL = "https://script.google.com/macros/s/AKfycbx4uqAyNCs7YRdS-LCzh7rA3HJg3JLEcC4XxDKFdNnXGF8VkjEvV8xRmZjcN2HMAtrs/exec?mode=votes";
  const canvas = document.getElementById("canvas");
  const promptDiv = document.getElementById("prompt");
  let responseMap = {};
  let responseOrder = [];

  function getWordCount(s) {
    return s.split(" ").filter(w => [...w].some(ch => /\w/.test(ch))).length;
  }

  async function loadResponses() {
    const res = await fetch(macroURL);
    const data = await res.json();
    promptDiv.textContent = data.prompt || "Prompt not found";

    Object.entries(data).forEach(([key, value]) => {
      if (key === "prompt") return;
      responseMap[key] = value;
      responseOrder.push(key);

      const div = document.createElement("div");
      div.className = "response";
      div.draggable = true;
      div.textContent = `${value} (${getWordCount(value)} words)`;
      div.dataset.letter = key;

      div.addEventListener("dragstart", e => {
        e.dataTransfer.setData("text/plain", e.target.dataset.letter);
      });

      canvas.appendChild(div);
    });

    canvas.addEventListener("dragover", e => e.preventDefault());
    canvas.addEventListener("drop", e => {
      e.preventDefault();
      const draggedLetter = e.dataTransfer.getData("text/plain");
      const draggedElem = [...canvas.children].find(el => el.dataset.letter === draggedLetter);
      const dropTarget = e.target.closest(".response");
      if (dropTarget && dropTarget !== draggedElem) {
        canvas.insertBefore(draggedElem, dropTarget);
      }
    });
  }

  function submitVote() {
  const name = document.getElementById("voterName").value.trim();
  if (!name) return alert("Please enter your name.");

  const orderedLetters = [...canvas.children].map(el => el.dataset.letter);
  const voteString = `[MEGA ${orderedLetters.join("")}]`;

  const query = new URLSearchParams({
    mode: "voting",
    username: name,
    vote: voteString
  });

  fetch(`https://script.google.com/macros/s/AKfycbx4uqAyNCs7YRdS-LCzh7rA3HJg3JLEcC4XxDKFdNnXGF8VkjEvV8xRmZjcN2HMAtrs/exec?${query.toString()}`)
    .then(res => res.text())
    .then(msg => alert("Vote submitted: " + voteString))
    .catch(err => alert("Error submitting vote."));
}


  loadResponses();
</script>

</body>
</html>
