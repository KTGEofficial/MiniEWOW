<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MAPDOS Response Submission</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #fdf6e3; color: #333; }
    textarea { width: 100%; height: 150px; font-size: 1.2em; margin-bottom: 1em; }
    .output { font-size: 1.1em; margin-top: 1em; }
    .label { font-weight: bold; }
  </style>
</head>
<body>
  <h1>MAPDOS Response Submission</h1><p>Choose your contestant</p>
<select id="userSelect"></select>
<div id="promptDisplay"></div>

  <input id="textInput" placeholder="Type your response here..." type="text">
  <div class="output">
    <div><span class="label">Word Count:</span> <span id="wordCount">0</span></div>
    <div><span class="label">Calorie Cost:</span> <span id="calorieCost">0</span></div>
  </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  let glyphData = {};
  let mapdosData = {};

  // DOM references
  const select = document.getElementById("userSelect");
  const userInfoContainer = document.getElementById("userInfo");
  const promptContainer = document.getElementById("promptDisplay");
  const textInput = document.getElementById("textInput");
  const wordCountDisplay = document.getElementById("wordCount");
  const calorieCostDisplay = document.getElementById("calorieCost");

  // Defensive check
  if (!select || !userInfoContainer || !promptContainer || !textInput || !wordCountDisplay || !calorieCostDisplay) {
    console.error("Missing one or more required DOM elements.");
    return;
  }

  // Load glyph density JSON
  fetch("https://ktgeofficial.github.io/MiniEWOW/MAPDOS/MAPDOSfontProportions.json")
    .then(response => response.json())
    .then(data => {
      glyphData = data;
    })
    .catch(err => console.error("Failed to load glyph data:", err));

  // Load MAPDOS JSON from Apps Script
  fetch("https://script.google.com/macros/s/AKfycbw1iY86evimRga_XhGddO2AlQyb63srbFsSeC-31RGc5FmKir9-EyG7tUIs6PS8MDai/exec?mode=submissions")
    .then(response => response.json())
    .then(data => {
      mapdosData = data;
      console.log("MAPDOS Data:", data);
      populateUserDropdown(data);
      displayPrompt(data.prompt);
    })
    .catch(err => console.error("Failed to load MAPDOS data:", err));

  function populateUserDropdown(data) {
    select.innerHTML = ""; // Clear old options

    Object.keys(data).forEach(key => {
      if (key === "prompt") return;
      const option = document.createElement("option");
      option.value = key;
      option.textContent = key;
      select.appendChild(option);
    });

    // Display first user info by default
    const firstUser = select.options[0]?.value;
    if (firstUser) {
      displayUserInfo(data[firstUser]);
    }

    select.addEventListener("change", () => {
      const selectedUser = select.value;
      displayUserInfo(data[selectedUser]);
    });
  }

  function displayUserInfo(info) {
    if (!info || !userInfoContainer) {
      console.warn("User info or container missing.");
      return;
    }

    let html = `
      <p><strong>Health:</strong> ${info.health}</p>
      <p><strong>Stomach:</strong> ${info.stomach}</p>
      <p><strong>Capacity:</strong> ${info.capacity}</p>
      <p><strong>Rank:</strong> ${info.rank}</p>
      <p><strong>Food Inventory:</strong></p>
      <ul>
    `;

    for (let key in info.food) {
      const item = info.food[key];
      html += `<li>${item.name} (${item.food}) â€” Mass: ${item.mass}, Expired: ${item.expired}</li>`;
    }

    html += `</ul>`;
    userInfoContainer.innerHTML = html;
  }

  function displayPrompt(promptText) {
    if (!promptContainer) return;
    promptContainer.innerHTML = `<p><strong>Prompt:</strong> ${promptText}</p>`;
  }

  function getWordCount(str) {
    const words = str.split(" ");
    let count = 0;
    for (let word of words) {
      if ([...word].some(ch => /\w/.test(ch))) {
        count++;
      }
    }
    return count;
  }

  function getCalorieCost(str) {
    let cost = 0;
    for (let ch of str) {
      cost += glyphData[ch] || 0;
    }
    return cost;
  }

  textInput.addEventListener("input", () => {
    const text = textInput.value;
    wordCountDisplay.textContent = getWordCount(text);
    calorieCostDisplay.textContent = getCalorieCost(text);
  });
});
</script>




</body>
</html>
